# Virus Host Prediction

Protein language model to predict the host of a given virus sequence.

Input: a viral protein sequence
Output: Probabilities for the $n$ different classes

## Repository Organization
- **deployment**
  - arc: shell scripts for deployments in arc
- **input**: 
    - config-files: yaml config files for data-preprocessing, prediction, and evaluation tasks.
    - data: raw fasta files of protein sequences and five independent splits with training and testing files
      - HEV virus protein sequences downloaded from
      - all mammlian and aves virus protein sequences download from UniRef90.
  raw: Folder containing raw protein sequences in fasta format. 
    - processed: Folder containing all preprocessed protein sequences with labels to be supplied as input to classification models.
- output: 
    - raw: Output files with predictions from the classification models.
    - evaluation: Intermediary output files with evaluation metric values generated by evaluation pipeline.
    - visualization: Result figures/visualizations.
    - logs: Log files generated during experiment executions.
- src: source code
---
## Data
Input protein sequence data used for all virus host prediction experiments are located at [input/data](input/data)

- [UniRef90](input/data/uniref90/20240131)
- [Coronaviridae Spike protein sequences](input/data/coronaviridae/20240313)
---
## Prerequisites:
### ARC Setup
- Request Dr. T. M. Murali to add you to the `seqevol` project in ARC.
- SSH into `tinkercliffs1.arc.vt.edu`.
- Clone the GitHub repository at the desired location.
- Instantiate conda environment
```shell
bash
conda create -n zoonosis
```
- Access input data files and pre-trained models
```shell
<Insert path to project folder>
```

### Install Dependencies
Install python dependencies via 
```shell 
pip install -R ./requirements.txt
pip install numpy --pre torch --index-url https://download.pytorch.org/whl/cu117
pip install -r requirements.txt
pip install pyyaml
conda install pandas
```
---
## Usage
### General usage:
```shell
python src/zoonosis.py -c <path-to-config-file>
```
Example
```shell
python src/zoonosis.py -c 
```


### ARC Deployment
Choose the deployment script based on the use-case

Examples
- [zoonosis_gpu](deployment/arc/zoonosis_gpu.sh)
```shell
sbatch deployment/arc/zoonosis_gpu.sh . input/config-files/transfer_learning/fine_tuning/uniref90-fine-tuning-host-prediction-multi.yaml
```

- [misc_gpu](deployment/arc/misc_gpu.sh)
```shell
sbatch deployment/arc/zoonosis_gpu.sh . <path-to-script-to-executed> <arguments-required-by-the-script>
```

- Execute [perturbation_dataset_generator.py](src/utils/scripts/perturbation_dataset_generator.py) using [misc_gpu](deployment/arc/misc_gpu.sh)
```shell
sbatch deployment/arc/misc_gpu.sh . src/utils/scripts/perturbation_dataset_generator.py -if input/data/coronaviridae/20240313/sarscov2/uniprot/coronaviridae_s_uniprot_sars_cov_2.csv -od input/data/coronaviridae/20240313/sarscov2/uniprot/perturbation_dataset/multi -st protein
```
---
## Adding a pre-trained protein language model to the Virus Host Prediction Pipeline

1. Create a child class of [ProteinSequenceClassification](src/models/protein_sequence_classification.py) within [models](src/models)
2. Implement the `get_embedding()` method that will generate the embeddings for a given batch of protein sequences
3. The default implementation of `forward()` in [ProteinSequenceClassification](src/models/protein_sequence_classification.py) will do the following - 
   - call the `get_embedding()` method
   - 